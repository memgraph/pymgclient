<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Connection class &#8212; pymgclient 1.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=bb516dca"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cursor class" href="cursor.html" />
    <link rel="prev" title="mgclient module content" href="module.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-mgclient">
<span id="connection-class"></span><h1><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> class<a class="headerlink" href="#module-mgclient" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mgclient.Connection">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mgclient.</span></span><span class="sig-name descname"><span class="pre">Connection</span></span><a class="headerlink" href="#mgclient.Connection" title="Link to this definition">¶</a></dt>
<dd><p>Encapsulates a database connection.</p>
<p>New instances are created using the factory function <a class="reference internal" href="module.html#mgclient.connect" title="mgclient.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a>.</p>
<p>Connections are not thread-safe.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="mgclient.Connection.autocommit">
<span class="sig-name descname"><span class="pre">autocommit</span></span><a class="headerlink" href="#mgclient.Connection.autocommit" title="Link to this definition">¶</a></dt>
<dd><p>This read/write attribute specifies whether executed statements
have immediate effect in the database.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, every executed statement has immediate effect.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, a new transaction is started at the execution of the first
command. Transactions must be manually terminated using <a class="reference internal" href="#mgclient.Connection.commit" title="mgclient.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> or
<a class="reference internal" href="#mgclient.Connection.rollback" title="mgclient.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rollback()</span></code></a> methods.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mgclient.Connection.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mgclient.Connection.close" title="Link to this definition">¶</a></dt>
<dd><p>Close the connection now.</p>
<p>The connection will be unusable from this point forward; an <a class="reference internal" href="module.html#mgclient.InterfaceError" title="mgclient.InterfaceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InterfaceError</span></code></a>
will be raised if any operation is attempted with the connection. The same applies
to all <a class="reference internal" href="cursor.html#mgclient.Cursor" title="mgclient.Cursor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cursor</span></code></a> objects trying to use the connection.</p>
<p>Note that closing a connection without committing the changes will cause an implicit
rollback to be performed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mgclient.Connection.commit">
<span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mgclient.Connection.commit" title="Link to this definition">¶</a></dt>
<dd><p>Commit any pending transaction to the database.</p>
<p>If auto-commit is turned on, this method does nothing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mgclient.Connection.cursor">
<span class="sig-name descname"><span class="pre">cursor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mgclient.Connection.cursor" title="Link to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="cursor.html#mgclient.Cursor" title="mgclient.Cursor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cursor</span></code></a> object using the connection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mgclient.Connection.rollback">
<span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mgclient.Connection.rollback" title="Link to this definition">¶</a></dt>
<dd><p>Roll back to the start of any pending transaction.</p>
<p>If auto-commit is turned on, this method does nothing.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mgclient.Connection.status">
<span class="sig-name descname"><span class="pre">status</span></span><a class="headerlink" href="#mgclient.Connection.status" title="Link to this definition">¶</a></dt>
<dd><p>Status of the connection.</p>
<dl class="simple">
<dt>It’s value can be one of the following macros:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><code class="xref py py-data docutils literal notranslate"><span class="pre">mgclient.CONN_STATUS_READY</span></code></dt><dd><p>The connection is currently not in a transaction and
it is ready to start executing the next command.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="xref py py-data docutils literal notranslate"><span class="pre">mgclient.CONN_STATUS_BAD</span></code></dt><dd><p>Something went wrong with the connection, it cannot be
used for command execution anymore.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="xref py py-data docutils literal notranslate"><span class="pre">mgclient.CONN_STATUS_CLOSED</span></code></dt><dd><p>The connection was closed by user, it cannot be
used for command execution anymore.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="xref py py-data docutils literal notranslate"><span class="pre">mgclient.CONN_STATUS_IN_TRANSACTION</span></code></dt><dd><p>The connection is currently in an implicitly started
transaction.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="xref py py-data docutils literal notranslate"><span class="pre">mgclient.CONN_STATUS_EXECUTING</span></code></dt><dd><p>The connection is currently executing a query. This status
can only be seen for lazy connections.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="lazy-connections">
<span id="id1"></span><h2>Lazy connections<a class="headerlink" href="#lazy-connections" title="Link to this heading">¶</a></h2>
<p>When a query is executed using <a class="reference internal" href="cursor.html#mgclient.Cursor.execute" title="mgclient.Cursor.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> on a cursor, the default
<a class="reference internal" href="usage.html#module-mgclient" title="mgclient"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mgclient</span></code></a> behaviour is to wait for all of the results to be available
and store them into cursor’s internal result list. On one hand, that means that
<a class="reference internal" href="cursor.html#mgclient.Cursor.execute" title="mgclient.Cursor.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> will block until all of the results are ready and all results
will be stored in memory at the same time. On the other hand, that also means
that result fetching methods will never block.</p>
<p>Sometimes, that behaviour is unwanted. Maybe we don’t need all results in
memory at the same time, because we only want to do row-by-row processing on
huge result sets. In that case, we may use a lazy connection.</p>
<p>A lazy connection is created by passing <code class="docutils literal notranslate"><span class="pre">True</span></code> for <code class="docutils literal notranslate"><span class="pre">lazy</span></code> parameter when
calling <a class="reference internal" href="module.html#mgclient.connect" title="mgclient.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a>. Cursors created using lazy connections will only try
to read results from the network socket when <a class="reference internal" href="cursor.html#mgclient.Cursor.fetchone" title="mgclient.Cursor.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetchone()</span></code></a>,
<a class="reference internal" href="cursor.html#mgclient.Cursor.fetchmany" title="mgclient.Cursor.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetchmany()</span></code></a> or <a class="reference internal" href="cursor.html#mgclient.Cursor.fetchall" title="mgclient.Cursor.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetchall()</span></code></a> is called. Also, they can allocate less
memory because they don’t have to store the entire result set in memory at
once.</p>
<p>However, lazy connections have two limitations:</p>
<blockquote>
<div><ol class="arabic">
<li><p>They are always in autocommit mode. If necessary, transactions can be
explicitly managed by executing <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code>, <code class="docutils literal notranslate"><span class="pre">COMMIT</span></code> or <code class="docutils literal notranslate"><span class="pre">ROLLBACK</span></code>
queries.</p></li>
<li><p>At most one query can execute at a given time. Trying to execute multiple
queries at once will raise an <a class="reference internal" href="module.html#mgclient.InterfaceError" title="mgclient.InterfaceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InterfaceError</span></code></a>.</p>
<p>Before trying to execute a new query, all results of the previous query
must be fetched from its corresponding cursor (for example by calling
<a class="reference internal" href="cursor.html#mgclient.Cursor.fetchone" title="mgclient.Cursor.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetchone()</span></code></a> until it returns <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>, or by calling
<a class="reference internal" href="cursor.html#mgclient.Cursor.fetchmany" title="mgclient.Cursor.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetchmany()</span></code></a>).</p>
</li>
</ol>
</div></blockquote>
<p>Here’s an example usage of a lazy connection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">mgclient</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">mgclient</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7687</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UNWIND range(1, 3) AS n RETURN n * n&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(1, )</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(4, )</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(9, )</span>

<span class="go"># We still didn&#39;t get None from fetchone()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;RETURN 100&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="gr">mgclient.InterfaceError</span>: <span class="n">cannot call execute during execution of a query</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">None</span>

<span class="go"># Now we can execute a new query</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;RETURN 100&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pymgclient</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Basic module usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mgclient</span></code> module content</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mgclient.Connection"><code class="docutils literal notranslate"><span class="pre">Connection</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#lazy-connections">Lazy connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cursor.html"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cursor</span></code> class</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="module.html" title="previous chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mgclient</span></code> module content</a></li>
      <li>Next: <a href="cursor.html" title="next chapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cursor</span></code> class</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Memgraph Ltd..
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/connection.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>